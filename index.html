<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Raport Kredytowy</title>

  <link rel="manifest" href="./manifest.json" />
  <link rel="icon" href="./icon-192.png" sizes="192x192" type="image/png" />

  <meta name="theme-color" content="#0b1220" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="color-scheme" content="dark light" />

  <style>
    :root{
      --bg:#0b0f14;
      --card:#121821;
      --border: rgba(255,255,255,.08);
      --text:#e5eaf0;
      --muted:#9fb0c7;
      --accent:#52b0ff;
      --accent-2:#7bc0ff;
      --good:#10b981;
      --bad:#ef4444;
      --radius:16px;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;background:var(--bg);color:var(--text);
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
      -webkit-font-smoothing:antialiased; text-rendering:optimizeLegibility;
    }
    .safe{ padding: calc(env(safe-area-inset-top) + 8px) 14px calc(env(safe-area-inset-bottom) + 24px); }
    .wrap{ max-width:560px; margin:0 auto; display:grid; gap:14px; }

    .card{ background:var(--card); border:1px solid var(--border); border-radius:var(--radius); box-shadow:var(--shadow); }
    .pad{ padding:14px; }

    .title{
      display:flex; align-items:center; justify-content:center; gap:10px;
      font-weight:800; font-size:20px; color:var(--accent); text-align:center;
    }
    .badge{
      display:inline-block; margin-top:6px; padding:6px 10px; border-radius:999px;
      background:rgba(255,255,255,.06); color:var(--muted); font-size:12px; text-align:center;
    }
    #asOf{ display:block; text-align:center; }

    /* KPI */
    .kpi-grid{ display:grid; grid-template-columns:1fr; gap:10px; }
    .kpi{
      text-align:center; display:flex; flex-direction:column; align-items:center; justify-content:center;
      min-height:92px; gap:6px;
    }
    .kpi .label{ font-size:12px; color:var(--muted); text-transform:uppercase; letter-spacing:.04em; }
    .kpi .value{ font-size:28px; font-weight:800; white-space:nowrap; line-height:1.1; }
    .value.up{color:var(--bad)} .value.down{color:var(--good)}

    /* Progress bar */
    .pbar{ position:relative; height:28px; border-radius:14px; background:rgba(255,255,255,.06); border:1px solid var(--border); overflow:hidden; }
    .pbar-fill{ position:absolute; left:0; top:0; bottom:0; width:0; background:linear-gradient(90deg,var(--accent),var(--accent-2)); }
    .pbar-label{ position:absolute; inset:0; display:flex; align-items:center; justify-content:center; font-weight:800; }

    /* Tabele */
    table{ width:100%; border-collapse:separate; border-spacing:0; }
    th,td{ padding:12px 14px; border-bottom:1px solid var(--border); font-size:14px; text-align:left; vertical-align:middle; }
    th{ color:#cfe2ff; }
    tr:last-child td{ border-bottom:0; }

    /* FRA & WIBOR: kolumny 1 i 3 bez zawijania */
    #fraTableWrap table td:nth-child(1),
    #fraTableWrap table td:nth-child(3),
    #fraTableWrap table th:nth-child(1),
    #fraTableWrap table th:nth-child(3),
    #histTableWrap table td:nth-child(1),
    #histTableWrap table td:nth-child(3),
    #histTableWrap table th:nth-child(1),
    #histTableWrap table th:nth-child(3){
      white-space:nowrap;
    }

    /* Charts */
    .chart-box{ min-height:160px }
    canvas{ width:100%!important; height:auto!important; display:block }

    /* Footer */
    .footer{ display:flex; justify-content:center; gap:10px }
    .btn{ appearance:none; border:0; border-radius:12px; padding:10px 14px; font-weight:700; background:var(--accent); color:#fff; cursor:pointer }

    /* Accordion with iOS-like status dot */
    .acc-head{
      position:relative;
      width:100%;
      background:transparent;
      border:0;
      padding:14px 40px;
      display:flex;
      align-items:center;
      justify-content:center;      /* nag≈Ç√≥wek wy≈õrodkowany */
      color:var(--accent);
      font-weight:800;
      font-size:18px;
      cursor:pointer;
    }
    .acc-dot{
      position:absolute; left:16px; top:50%; transform:translateY(-50%);
      width:12px; height:12px; border-radius:50%;
      background:#3a3f46;                    /* szare gdy zamkniƒôte */
      box-shadow:0 0 0 rgba(16,185,129,0);
      transition:background .2s ease, box-shadow .25s ease, transform .08s ease;
    }
    .acc-head:active .acc-dot{ transform:translateY(-50%) scale(0.95); }
    .acc-head[aria-expanded="true"] .acc-dot{
      background:var(--good);                 /* zielone gdy otwarte */
      box-shadow:0 0 10px rgba(16,185,129,.45);
    }
    .acc-chev{
      position:absolute; right:16px; top:50%; transform:translateY(-50%) rotate(-45deg);
      width:10px; height:10px;
      border-right:2px solid var(--accent);
      border-bottom:2px solid var(--accent);
      transition:transform .2s ease;
    }
    .acc-head[aria-expanded="true"] .acc-chev{ transform:translateY(-50%) rotate(45deg); }

    .acc-body{ display:none; }
    .acc-body.open{ display:block; }
  </style>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <!-- Konfiguracja -->
  <script>
    window.APP_VERSION = 'v3.5.4'; /* tylko do cache/SW */
    window.RAPORT_ENDPOINT = 'https://script.google.com/macros/s/AKfycbymwnWurFrti71e3PDkm658dfRswPE-OFjTGKs24TdxYi2aS2btOPTm2Hb5xsOLe4II9w/exec?path=/api/report/json';
    function getCSS(prop){ return getComputedStyle(document.documentElement).getPropertyValue(prop)||'#ffffff'; }
  </script>
</head>
<body>
  <div class="safe">
    <div class="wrap">

      <!-- HEADER -->
      <header class="card">
        <div class="pad">
          <div class="title">üìä Raport Kredytowy</div>
          <div id="asOf" class="badge">≈Åadowanie‚Ä¶</div>
        </div>
      </header>

      <!-- KPI CARDS -->
      <section class="kpi-grid">
        <div class="card"><div class="pad kpi"><div class="label">WIBOR 3M</div><div class="value" id="wibor">‚Äî</div></div></div>
        <div class="card"><div class="pad kpi"><div class="label">Obecna rata</div><div class="value" id="curr">‚Äî</div></div></div>
        <div class="card"><div class="pad kpi"><div class="label">Szac. nowa rata</div><div class="value" id="new">‚Äî</div></div></div>
        <div class="card"><div class="pad kpi"><div class="label">R√≥≈ºnica</div><div class="value" id="diff">‚Äî</div></div></div>
        <div class="card"><div class="pad kpi"><div class="label">Pozosta≈Ço rat</div><div class="value" id="raty">‚Äî</div><div style="color:var(--muted);margin-top:6px" id="ratySub">‚Äî</div></div></div>
      </section>

      <!-- POSTƒòP SP≈ÅATY -->
      <section class="card">
        <button class="acc-head" data-target="acc-progress" aria-expanded="false">
          <span class="acc-dot" aria-hidden="true"></span>
          Postƒôp sp≈Çaty
          <span class="acc-chev" aria-hidden="true"></span>
        </button>
        <div id="acc-progress" class="acc-body">
          <div class="pad">
            <div class="pbar" style="margin:12px 0 10px">
              <div class="pbar-fill" id="bar"></div>
              <div class="pbar-label" id="barLabel">0%</div>
            </div>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
              <div class="card" style="background:rgba(255,255,255,.04)"><div class="pad"><div style="color:var(--muted);text-align:center">Kapita≈Ç poczƒÖtkowy</div><b id="init" style="display:block;text-align:center">‚Äî</b></div></div>
              <div class="card" style="background:rgba(255,255,255,.04)"><div class="pad"><div style="color:var(--muted);text-align:center">Kapita≈Ç sp≈Çacony</div><b id="paid" style="display:block;text-align:center">‚Äî</b></div></div>
              <div class="card" style="background:rgba(255,255,255,.04)"><div class="pad"><div style="color:var(--muted);text-align:center">Pozosta≈Ço do sp≈Çaty</div><b id="rem" style="display:block;text-align:center">‚Äî</b></div></div>
              <div class="card" style="background:rgba(255,255,255,.04)"><div class="pad"><div style="color:var(--muted);text-align:center">Sp≈Çacono</div><b id="pct" style="display:block;text-align:center">‚Äî</b></div></div>
            </div>
          </div>
        </div>
      </section>

      <!-- STRUKTURA RATY -->
      <section class="card">
        <button class="acc-head" data-target="acc-pie" aria-expanded="false">
          <span class="acc-dot" aria-hidden="true"></span>
          Struktura najbli≈ºszej raty
          <span class="acc-chev" aria-hidden="true"></span>
        </button>
        <div id="acc-pie" class="acc-body">
          <div class="pad">
            <div class="chart-box" style="max-width:360px;margin:0 auto">
              <canvas id="pieChart"></canvas>
            </div>
            <div style="display:flex;justify-content:center;gap:16px;margin-top:10px">
              <div><span style="display:inline-block;width:10px;height:10px;background:#3b82f6;border-radius:3px;margin-right:6px"></span>Odsetki: <b id="odsetki">‚Äî</b></div>
              <div><span style="display:inline-block;width:10px;height:10px;background:#93c5fd;border-radius:3px;margin-right:6px"></span>Kapita≈Ç: <b id="kapital">‚Äî</b></div>
            </div>
          </div>
        </div>
      </section>

      <!-- WIBOR -->
      <section class="card">
        <button class="acc-head" data-target="acc-wibor" aria-expanded="false">
          <span class="acc-dot" aria-hidden="true"></span>
          Historia WIBOR 3M
          <span class="acc-chev" aria-hidden="true"></span>
        </button>
        <div id="acc-wibor" class="acc-body">
          <div class="pad">
            <div class="chart-box"><canvas id="wiborChart"></canvas></div>
          </div>
          <div class="pad" id="histTableWrap"></div>
        </div>
      </section>

      <!-- FRA -->
      <section class="card">
        <button class="acc-head" data-target="acc-fra" aria-expanded="false">
          <span class="acc-dot" aria-hidden="true"></span>
          Prognozy FRA
          <span class="acc-chev" aria-hidden="true"></span>
        </button>
        <div id="acc-fra" class="acc-body">
          <div class="pad">
            <div class="chart-box"><canvas id="fraChart"></canvas></div>
          </div>
          <div class="pad" id="fraTableWrap"></div>
        </div>
      </section>

      <!-- ERRORS / ACTIONS -->
      <section class="card" id="errorBox" style="display:none;border-color:#fda4a4">
        <div class="pad" style="color:#ffd1d1"></div>
      </section>
      <div class="footer">
        <button id="retryBtn" class="btn" style="display:none">üîÑ Spr√≥buj ponownie</button>
        <button id="forceRefresh" class="btn">Wyczy≈õƒá cache</button>
      </div>

    </div>
  </div>

  <!-- Logika aplikacji -->
  <script src="./app.js?v=v3.5.2"></script>
</body>
</html>
